#!/bin/bash
# MyRAGDB Launcher Script

# Get the directory where this app bundle is located
APP_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
APP_BUNDLE="$(dirname "$(dirname "$APP_PATH")")"
PROJECT_ROOT="$(dirname "$APP_BUNDLE")"

# Change to project directory
cd "$PROJECT_ROOT"

# Trap signals to run stop.sh when app is quit (via Force Quit)
cleanup() {
    "$PROJECT_ROOT/stop.sh" 2>/dev/null
    exit 0
}

# Register signal handlers for graceful shutdown
trap cleanup SIGTERM SIGINT SIGHUP EXIT

# Run the startup script
./start.sh > /dev/null 2>&1

# Keep the app running in background (appears in Dock while services are running)
# To stop: Use "Force Quit" from Dock, or run: ./stop.sh
while true; do
    sleep 2
    # Check if any of the services are still running
    if [ ! -f "$PROJECT_ROOT/.server.pid" ] && [ ! -f "$PROJECT_ROOT/.middleware.pid" ]; then
        exit 0
    fi
done
