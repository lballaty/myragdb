<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MyRAGDB - Hybrid Search System</title>
    <link rel="stylesheet" href="static/css/styles.css?v=2026.01.07.2.47.0">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap;">
                <h1>üîç MyRAGDB</h1>
                <span id="version-badge" class="version-badge">v...</span>
                <span id="repo-status-badge" class="repo-status-badge repo-loading">
                    <span class="repo-badge-icon">‚è≥</span>
                    <span class="repo-badge-text">Loading repositories...</span>
                </span>
                <span id="llm-status-badge" class="llm-status-badge llm-none">
                    <span class="llm-badge-icon">ü§ñ</span>
                    <span class="llm-badge-text">No LLM Running</span>
                </span>
                <a href="llm-chat-tester.html" style="color: white; text-decoration: none; font-size: 0.95em; font-weight: 600; padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: inline-block; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); border: 2px solid rgba(255, 255, 255, 0.2);">
                    üí¨ LLM Chat Tester
                </a>
                <button id="status-indicator" class="status-indicator" style="cursor: default; padding: 8px 16px; border-radius: 8px; border: 2px solid rgba(255, 255, 255, 0.2); font-weight: 600; transition: all 0.3s;">
                    <span class="status-dot"></span>
                    <span class="status-text">Checking...</span>
                </button>
            </div>
            <p class="subtitle">Hybrid Search System - Meilisearch Keyword + Vector Embeddings</p>
            <p class="subtitle" style="font-size: 0.85em; opacity: 0.7; margin-top: -8px;">
                <span style="font-weight: 600; opacity: 1;">Start:</span> <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px;">/Users/liborballaty/LocalProjects/GitHubProjectsDocuments/myragdb/start.sh</code>
                <span style="margin: 0 8px;">|</span>
                <span style="font-weight: 600; opacity: 1;">Stop:</span> <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px;">/Users/liborballaty/LocalProjects/GitHubProjectsDocuments/myragdb/stop.sh</code>
                <span style="display: block; margin-top: 4px; font-size: 0.9em; opacity: 0.8;">(Starts: Meilisearch ‚Üí MyRAGDB API ‚Üí MCP Middleware ‚Üí Opens Browser | Stops: MCP Middleware ‚Üí MyRAGDB API ‚Üí Meilisearch)</span>
            </p>
            <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px; margin-top: 12px;">
                <button id="restart-server-button" class="restart-button" title="Restart MyRAGDB server" style="display: none;">
                    üîÑ Restart
                </button>
                <div id="indexing-progress" class="indexing-progress" style="display: none;">
                    <div class="indexing-progress-header">
                        <span class="spinner" style="width: 14px; height: 14px; border-width: 2px;"></span>
                        <span id="indexing-header-text">Indexing...</span>
                    </div>
                    <div class="indexing-progress-details">
                        <div id="indexing-detail-text"></div>
                        <div class="indexing-progress-bar">
                            <div id="indexing-progress-bar-fill" class="indexing-progress-bar-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" data-tab="search">Search</button>
            <button class="tab-button" data-tab="activity">Activity Monitor</button>
            <button class="tab-button" data-tab="repositories">Repositories</button>
            <button class="tab-button" data-tab="observability">Observability</button>
            <button class="tab-button" data-tab="llm-manager">LLM Manager</button>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content active">
            <div class="search-section">
                <div class="search-box">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Search for code, documentation, patterns..."
                        autocomplete="off"
                    >
                    <button id="search-button" class="primary-button">Search</button>
                </div>

                <div class="search-filters">
                    <label>
                        <span>Search Type:</span>
                        <select id="search-type">
                            <option value="hybrid">Hybrid (Keyword + Vector)</option>
                            <option value="keyword">Keyword Only</option>
                            <option value="semantic">Semantic Only</option>
                        </select>
                    </label>
                    <label>
                        <span>Repository:</span>
                        <select id="repository-filter" style="min-width: 200px;">
                            <option value="">All Repositories</option>
                        </select>
                    </label>
                    <label>
                        <span>Results:</span>
                        <select id="result-limit">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </label>
                </div>

                <div class="search-filters-advanced" id="advanced-filters" style="display: none;">
                    <label>
                        <span>Folder Filter:</span>
                        <input type="text" id="folder-filter" placeholder="e.g., src/components">
                    </label>
                    <label>
                        <span>Extension Filter:</span>
                        <input type="text" id="extension-filter" placeholder="e.g., .py, .ts">
                    </label>
                </div>

                <div style="margin-top: 8px;">
                    <button id="toggle-advanced-filters" class="secondary-button" style="font-size: 0.9em; padding: 6px 12px;">
                        üîΩ Advanced Filters
                    </button>
                </div>

                <div id="search-results" class="search-results"></div>
            </div>
        </div>

        <!-- Activity Monitor Tab -->
        <div id="activity-tab" class="tab-content">
            <div class="activity-section">
                <div class="activity-controls">
                    <div class="activity-tabs">
                        <button id="tab-ui-logs" class="activity-tab-button active">UI Activity</button>
                        <button id="tab-server-logs" class="activity-tab-button">Server Logs</button>
                    </div>
                    <div class="activity-controls-group">
                        <label id="log-level-filter" style="display: none;">
                            <span>Level:</span>
                            <select id="log-level-select">
                                <option value="">All</option>
                                <option value="ERROR">ERROR</option>
                                <option value="WARNING">WARNING</option>
                                <option value="INFO">INFO</option>
                            </select>
                        </label>
                        <label id="log-lines-filter" style="display: none;">
                            <span>Lines:</span>
                            <select id="log-lines-select">
                                <option value="50">50</option>
                                <option value="100" selected>100</option>
                                <option value="200">200</option>
                                <option value="500">500</option>
                            </select>
                        </label>
                        <button id="refresh-activity" class="secondary-button">üîÑ Refresh</button>
                        <button id="clear-activity" class="secondary-button">üóëÔ∏è Clear</button>
                    </div>
                </div>
                <div id="activity-log" class="activity-log"></div>
                <div id="server-logs" class="activity-log" style="display: none;"></div>
            </div>
        </div>

        <!-- Repositories Tab -->
        <div id="repositories-tab" class="tab-content">
            <div class="repositories-section">
                <!-- Discovery Section -->
                <div class="discovery-section">
                    <h3>üìÇ Repository Discovery</h3>

                    <div class="discovery-controls">
                        <input type="text" id="discovery-path" placeholder="Root path to scan (e.g., /Users/user/projects)" value="/Users/liborballaty/LocalProjects">
                        <select id="discovery-depth">
                            <option value="1">Depth: 1</option>
                            <option value="2" selected>Depth: 2</option>
                            <option value="3">Depth: 3</option>
                            <option value="4">Depth: 4</option>
                            <option value="5">Depth: 5</option>
                        </select>
                        <button id="scan-repositories-button" class="primary-button">üîç Scan for Repositories</button>
                    </div>

                    <!-- Filters -->
                    <div class="discovery-filters" id="discovery-filters" style="display: none;">
                        <label>
                            <span>Search Repositories</span>
                            <input type="text" id="filter-repo-search" placeholder="Search by name or path...">
                        </label>
                        <label>
                            <span>Status Filter</span>
                            <select id="filter-repo-status">
                                <option value="all">All Repositories</option>
                                <option value="new">New Only</option>
                                <option value="indexed">Already Indexed</option>
                                <option value="excluded">Excluded (Locked)</option>
                            </select>
                        </label>
                        <label>
                            <span>Priority Filter</span>
                            <select id="filter-repo-priority">
                                <option value="all">All Priorities</option>
                                <option value="high">High Priority</option>
                                <option value="medium">Medium Priority</option>
                                <option value="low">Low Priority</option>
                            </select>
                        </label>
                        <label>
                            <span>Created After</span>
                            <input type="date" id="filter-created-after" placeholder="YYYY-MM-DD">
                        </label>
                        <label>
                            <span>Created Before</span>
                            <input type="date" id="filter-created-before" placeholder="YYYY-MM-DD">
                        </label>
                        <label>
                            <span>Modified After</span>
                            <input type="date" id="filter-modified-after" placeholder="YYYY-MM-DD">
                        </label>
                        <label>
                            <span>Modified Before</span>
                            <input type="date" id="filter-modified-before" placeholder="YYYY-MM-DD">
                        </label>
                    </div>

                    <!-- Bulk Actions -->
                    <div class="discovery-bulk-actions" id="discovery-bulk-actions" style="display: none;">
                        <button id="select-all-new-button" class="secondary-button">Select All New</button>
                        <button id="select-all-visible-button" class="secondary-button">Select All Visible</button>
                        <label>
                            <span>Default Priority:</span>
                            <select id="default-priority-select" class="priority-dropdown">
                                <option value="high">High</option>
                                <option value="medium" selected>Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </label>
                        <button id="add-selected-button" class="primary-button">‚ûï Add Selected to Config</button>
                    </div>

                    <!-- Discovered Repository Cards -->
                    <div id="discovered-repos-container" class="discovered-repos-container"></div>

                    <!-- Pagination -->
                    <div class="discovery-pagination" id="discovery-pagination" style="display: none;">
                        <div class="pagination-info" id="pagination-info"></div>
                        <div class="pagination-controls">
                            <button id="pagination-prev" class="secondary-button">‚Üê Previous</button>
                            <button id="pagination-next" class="secondary-button">Next ‚Üí</button>
                        </div>
                    </div>
                </div>

                <div class="reindex-section">
                    <h3>üîÑ Re-index Repositories</h3>
                    <div class="repository-selection">
                        <div class="repository-header">
                            <label>
                                <input type="checkbox" id="select-all-repos">
                                <strong>Select All</strong>
                            </label>
                        </div>
                        <div id="repository-list" class="repository-list">
                            <div class="loading">Loading repositories...</div>
                        </div>
                    </div>

                    <!-- Index Type Selection -->
                    <div class="index-options">
                        <div class="index-option-group">
                            <h4>Index Types:</h4>
                            <label>
                                <input type="checkbox" id="index-keyword" checked>
                                <strong>Keyword (Meilisearch)</strong>
                                <span class="option-hint">Fast keyword matching with typo tolerance</span>
                            </label>
                            <label>
                                <input type="checkbox" id="index-vector" checked>
                                <strong>Vector (Semantic Search)</strong>
                                <span class="option-hint">Slow but understands meaning</span>
                            </label>
                        </div>

                        <div class="index-option-group">
                            <h4>Index Mode:</h4>
                            <label>
                                <input type="radio" name="index-mode" id="mode-incremental" value="incremental" checked>
                                <strong>Incremental Update</strong>
                                <span class="option-hint">Fast - updates existing indexes</span>
                            </label>
                            <label>
                                <input type="radio" name="index-mode" id="mode-full" value="full">
                                <strong>Full Rebuild</strong>
                                <span class="option-hint">Slow - clears and rebuilds from scratch</span>
                            </label>
                        </div>
                    </div>

                    <div class="stats-controls">
                        <button id="reindex-button" class="primary-button">üîÑ Re-index Selected Repositories</button>
                        <div id="indexing-status" class="indexing-status" style="display: none;">
                            <span class="spinner"></span>
                            <span>Indexing in progress...</span>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div class="stats-section-header">
                    <h3>üìä System Statistics</h3>
                </div>

                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Keyword Documents</div>
                        <div class="stat-value" id="stat-keyword">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Vector Chunks</div>
                        <div class="stat-value" id="stat-vector">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Searches</div>
                        <div class="stat-value" id="stat-searches">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Response Time</div>
                        <div class="stat-value" id="stat-avg-time">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Indexing Run</div>
                        <div class="stat-value" id="stat-last-index">Never</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Current Status</div>
                        <div class="stat-value" id="stat-index-status">Ready</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Observability Tab -->
        <div id="observability-tab" class="tab-content">
            <div class="observability-section">
                <h3>üìä Observability</h3>
                <p class="subtitle">System metrics, performance tracking, and error monitoring</p>

                <!-- Time Range Selector -->
                <div class="observability-controls">
                    <label>
                        <span>Time Range:</span>
                        <select id="obs-time-range">
                            <option value="1">Last Hour</option>
                            <option value="24" selected>Last 24 Hours</option>
                            <option value="168">Last 7 Days</option>
                            <option value="720">Last 30 Days</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </label>
                    <div id="obs-custom-range" style="display: none;">
                        <input type="datetime-local" id="obs-start-time" />
                        <span>to</span>
                        <input type="datetime-local" id="obs-end-time" />
                    </div>
                    <button id="obs-refresh-button" class="primary-button">üîÑ Refresh</button>
                    <button id="obs-cleanup-button" class="secondary-button">üóëÔ∏è Cleanup Old Data</button>
                </div>

                <!-- Summary Stats Cards -->
                <div class="obs-stats-grid">
                    <div class="obs-stat-card">
                        <div class="obs-stat-label">Total Searches</div>
                        <div class="obs-stat-value" id="obs-total-searches">-</div>
                        <div class="obs-stat-sublabel">Avg: <span id="obs-avg-response-time">-</span>ms</div>
                    </div>
                    <div class="obs-stat-card">
                        <div class="obs-stat-label">Total Errors</div>
                        <div class="obs-stat-value" id="obs-total-errors">-</div>
                        <div class="obs-stat-sublabel">
                            <span class="obs-error-critical" id="obs-critical-errors">0</span> critical,
                            <span class="obs-error-error" id="obs-error-errors">0</span> errors
                        </div>
                    </div>
                    <div class="obs-stat-card">
                        <div class="obs-stat-label">Database Size</div>
                        <div class="obs-stat-value" id="obs-db-size">-</div>
                        <div class="obs-stat-sublabel"><span id="obs-total-rows">-</span> total records</div>
                    </div>
                    <div class="obs-stat-card">
                        <div class="obs-stat-label">Fastest Search</div>
                        <div class="obs-stat-value" id="obs-min-response-time">-</div>
                        <div class="obs-stat-sublabel">Slowest: <span id="obs-max-response-time">-</span>ms</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="obs-charts-section">
                    <!-- Search Performance Chart -->
                    <div class="obs-chart-container">
                        <h4>Search Performance Over Time</h4>
                        <canvas id="obs-search-performance-chart"></canvas>
                    </div>

                    <!-- Search Volume by Type -->
                    <div class="obs-chart-container">
                        <h4>Search Volume by Type</h4>
                        <canvas id="obs-search-type-chart"></canvas>
                    </div>

                    <!-- Error Rate Chart -->
                    <div class="obs-chart-container">
                        <h4>Error Rate Over Time</h4>
                        <canvas id="obs-error-rate-chart"></canvas>
                    </div>

                    <!-- Errors by Component -->
                    <div class="obs-chart-container">
                        <h4>Errors by Component</h4>
                        <canvas id="obs-error-component-chart"></canvas>
                    </div>
                </div>

                <!-- Recent Errors Table -->
                <div class="obs-errors-section">
                    <h4>Recent Errors</h4>
                    <div class="obs-errors-table-container">
                        <table class="obs-errors-table" id="obs-errors-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Severity</th>
                                    <th>Component</th>
                                    <th>Type</th>
                                    <th>Message</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="obs-errors-tbody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px;">
                                        Loading errors...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Indexing Events Table -->
                <div class="obs-indexing-section">
                    <h4>Recent Indexing Events</h4>
                    <div class="obs-indexing-table-container">
                        <table class="obs-indexing-table" id="obs-indexing-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Repository</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Files</th>
                                    <th>Duration</th>
                                </tr>
                            </thead>
                            <tbody id="obs-indexing-tbody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 20px;">
                                        Loading indexing events...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- LLM Manager Tab -->
        <div id="llm-manager-tab" class="tab-content">
            <div class="llm-manager-section">
                <h3>ü§ñ LLM Manager</h3>
                <p class="subtitle">Start and manage your local LLMs with different modes</p>

                <div id="llm-models-grid" class="llm-models-grid">
                    <!-- Models will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="reindex-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Confirm Re-indexing</h2>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button id="modal-cancel" class="secondary-button">Cancel</button>
                <button id="modal-confirm" class="primary-button">Proceed</button>
            </div>
        </div>
    </div>

    <!-- README Viewer Modal -->
    <div id="readme-modal" class="modal-overlay" style="display: none;">
        <div class="readme-modal-content">
            <div class="readme-modal-header">
                <h2 id="readme-modal-title">Repository README</h2>
                <button class="readme-modal-close" onclick="closeReadmeModal()">&times;</button>
            </div>
            <div class="readme-modal-body">
                <div id="readme-loading" class="readme-loading">
                    <div class="spinner"></div>
                    <p>Loading README...</p>
                </div>
                <div id="readme-error" class="readme-error" style="display: none;">
                    <p id="readme-error-message"></p>
                </div>
                <div id="readme-content" class="readme-content" style="display: none;"></div>
            </div>
            <div class="readme-modal-footer">
                <span id="readme-file-path" class="readme-file-path"></span>
                <button class="btn btn-secondary" onclick="closeReadmeModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="static/js/app.js?v=2026.01.07.2.47.0"></script>
</body>
</html>
